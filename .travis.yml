language: node_js
node_js:
- 8.12.0
sudo: required
services:
- docker
env:
  global:
  - CXX=g++-4.8
  matrix:
  - USE_SENTRY=1
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - g++-4.8
before_install:
- docker pull getsentry/sentry-cli
script:
- npm install
- npm run build:dll
- npm run build
before_deploy:
- bash deploy/sentry_release.sh
- find dist/ -type f -name "*.map" -delete
- zip -r dist.zip dist
deploy:
  provider: releases
  api_key:
    secure: HXkliap9naHHiDRDPPEDyD5N/Dr+v2xWua8kmVFnEVxs2Y+sPtB7ZqXd1Y/jQ5nnf0YEFzogArxCGwl6ydwHWv25vb+57xS48qThNmjvqO/CbGMbyWcg7aCR9kO+ZYKZQ7A6JRHFNqm/kjB3uJtKuWzbrkA74MqIsPC/8zP7ryU4wK3fmQdun5UGGmTTqv2D6ZTEdybwj4f5jxoJ+12L+H3OtGRhIaSVH1pGTMqK1PUZilurU7WAkx73XTkRccarXOY4hKzibeB5XJvVPFRye7LNFIQ/gZYdPMrMNaasBW6CiqHsNzCH9OUrir+2NFoJz7XT5gBR3rlUOtVVsLKU7rXIw0CJA0h75fvbhmZCyucvV0tvzZB7XIMwJO3TqS8rvkz0Fk+viShZ1q907DbnWaBaP2eARpBc0EMCrH+uvM+zzEA6a3A4Qee2wIEfJX7HVdi+fT/f5HwExd7jphgyWgP9zj7FtUqhG5ax6TJUkdxqZhKYBXi10zHFwUKH4Mw3ATRraN707VC5yMpTk1EvHPeEwL8c8+66SX70mtts1B6DxJtTCTtG8MulSOUMCDBmekrM6nKgloxkeDieIisGzaKT9zMfKIaG4HcOTgUEtZCio3l3ZODeF326ZyhkgIVaCeN9HtlMyFgCWi2Gu1TEaN2vmz8C7O+UQrS1f3dIMlU=
  file: dist.zip
  on:
    repo: starcatmeow/OnlineJudgeFE
    tags: true
