language: node_js
node_js:
- 8.12.0
sudo: required
services:
- docker
env:
  global:
  - CXX=g++-4.8
  matrix:
  - USE_SENTRY=1
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - g++-4.8
before_install:
- docker pull getsentry/sentry-cli
script:
- npm install
- npm run build:dll
- npm run build
before_deploy:
- bash deploy/sentry_release.sh
- find dist/ -type f -name "*.map" -delete
- zip -r dist.zip dist
deploy:
  provider: releases
  api_key:
    secure: js09eBiNpOGELehQFYI/zRDFPxVkqU2X0acvEjWnxENJOIzawZr7uVbRSyN1zRfSzKqxMKLptq5ZFqtWSdP4CV6eqG2Piu8avt0oc33lrKHRwngwdcjeMON3XKsgNaIKAfgR1O3uyxDJJe4z+fzdBRkBdZWeOEkrTymgZ61XZ8U1a4KDlSWTdd6/iWW+wim03ydwEWR9EPjGe3b13oNY2BRFhyiCW9mSDNByK9dqW3meQwXBGCzidzVnNbKFZswIRWksVHbzPKRJPpkifNyqCDZPlStUy9I8uuaweQj7WLmbJa23qNYYisq+vsVboTOBMTBp3oU4Pl9ypcr8zvNRB2njWzr/WgEMmk0JcOrLUv/lP41agUyx6x1lqR7rrI0NNBoqpC4NlgI3pxVoXUImqFUACfrhdME3Zd4XuH0TtJvQiC9mu4A4uyzJw2gDOswfjWFSJD2onpce9mb4lNasd9h5pdfp2pNlEfFdqvMy254/bcAPzgseZjI31MWYRXcWmdsOaHPkmlTKdmfldeqqTu0ym6vnXcQQli/FAfvtSY9b5sqGrjO9NzMfi7ioKaNPXFZSHqaNPEyPbHpAqWjo3eCGBff++6IAT1p2n683HsTTWrrLEdh8DJgbqMC1CUojWiyzL2ADNI3H8NknuZ0GRYCoLpKAbbA39RYNptknW5w=
  file: dist.zip
  on:
    repo: starcatmeow/OnlineJudgeFE
